HCanAWR.views.SettingsView = Ext.extend(Ext.Panel, {
	id: 'settingsView',
	scroll: 'vertical',
	layout: {
		type: 'vbox',
		align: 'stretch'
	},
	
	itemsList:	['generalSettingsTitle','languageSelectContainer','notificationSettingsTitle'],
	
	init: function(callback) {
		var that = this,
			everyCategory = (new Array()).concat([HCanAWR.conf.ALLCATEGORIES],HCanAWR.itemCategories),
			createSelectionPanel = function(name) {
				var localeKey = 'categoryTitle_' + name,
					title = getStr(localeKey),
					notificationName = name + 'Notifications',
					panelCls = 'settingsContainer settingsContainer' + window.utils.ucfirst(name),
					titleCls = 'settingsContainerTitle settingsContainerTitle' + window.utils.ucfirst(name),
					toggleCls = 'settingsToggle',
					toggleId = 'settingsToggle' + window.utils.ucfirst(name);
				
				that.panels[name] = new Ext.Container({
					cls: panelCls,
					items: [
						{
							xtype: 'container',
							html: title,
							cls: titleCls
						},
						{
							xtype: 'togglefield',
							id: toggleId,
							cls: toggleCls,
							value: (HCanAWR.appSettings.get(notificationName)*1)
						}
					]
				});
			};
		
		this.panels = {};
		
		// general settings title
		this.generalSettingsTitle = new Ext.Container({
			cls: 'settingsTitle',
			html: getStr('settings_generalSettings')
		});
		
		this.languageSelect = new Ext.form.Select({
			cls: 'settingsLanguageSelector',
			options: [
				{text: getStr('language_English'), value: 'en'},
				{text: getStr('language_French'),  value: 'fr'}
			],
			name: 'settingsLanguageSelector', // useless, but silences an error on some platforms.
			value: HCanAWR.appSettings.get('language')
		});
		
		this.languageSelectContainer = new Ext.Container({
			cls: 'settingsLanguageSelectContainer'
		});
		this.languageSelectContainer.add({
			xtype: 'container',
			cls: 'settingsContainerTitle settingsContainerTitle_Language',
			html: getStr('settings_language'),
		});
		this.languageSelectContainer.add( this.languageSelect );
		
		// notifications title
		this.notificationSettingsTitle = new Ext.Container({
			cls: 'settingsTitle',
			html: getStr('settings_notifications')
		});
		
		Ext.each(this.itemsList, function(item) {
			this.add(this[item]);
		}, this);
		
		// Create every category notification panel, add them after.
		Ext.each(everyCategory, createSelectionPanel);
		Ext.each(everyCategory, function(p) { that.add(that.panels[p]) }, this);
		
		callback();
	},
	
	displayCategories: function(show) {
		Ext.each(HCanAWR.itemCategories, function(name) {
			this.panels[name].setVisible(show);
		}, this);
		this.doLayout();
	}
});

